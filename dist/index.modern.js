import*as e from"react";import{useLayoutEffect as t,useEffect as r,useRef as n,useCallback as s,useState as o,useMemo as i}from"react";function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c.apply(this,arguments)}function l(e,t){if(null==e)return{};var r,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)t.indexOf(r=o[n])>=0||(s[r]=e[r]);return s}const u=(e,t,r)=>Math.max(t,Math.min(e,r));function a(...e){return t=>{e.forEach(e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)})}}function d(e,t,r){return e[t]?e[t][0]?e[t][0][r]:e[t][r]:"contentBoxSize"===t?e.contentRect["inlineSize"===r?"width":"height"]:void 0}const h=["root"],g=["node"];class v{constructor(){this.nodes=new Map,this.visibleNodes=new Map,this.animatingNodes=new Set,this.observer=null,this.scroller=null,this.direction=null,this.mounted=!1,this.prevYPosition=0,this.scroll=!0}setScrollDirection(e){this.direction=e<this.prevYPosition?"down":"up",this.prevYPosition=e}handleIntersecting(e){let t=e.target;if(e.isIntersecting)this.visibleNodes.set(t,e),t.classList.add("trigger");else{var r;if(!this.direction)return;const e="up"===this.direction;t.classList.remove("trigger"),t.style.setProperty("--trigger",e?" 1":" 0"),t.style.setProperty("--trigger-px",e&&null!=(r=t.dataset.end)?r:"0")}}updateEntries(e){this.visibleNodes=new Map,e.forEach(e=>{this.handleIntersecting(e)})}caluclatePosition(e){if(!e)return[0,0];var{top:t,height:r}=e.boundingClientRect;if(!e.rootBounds)return[0,0];var{height:n}=e.rootBounds,s=n-40,o=0,i=s+r;let c=e.target;c.dataset.start&&(o=parseInt(c.dataset.start,10)),c.dataset.end&&(i=parseInt(c.dataset.end,10));var l=i-o,a=s-t-o;return[u(a/l,0,1),u(a,0,l)]}update(){this.visibleNodes.forEach((e,t)=>{var r=t.style;const[n,s]=this.caluclatePosition(e),o="up"===this.direction,{onStart:i,onProgress:c,onEnd:l}=this.nodes.get(t);n>0&&n<1?(this.animatingNodes.has(t)||(this.animatingNodes.add(t),o&&i({node:t,entry:e,scrollingUp:o,progress:n})),c({node:t,entry:e,scrollingUp:o,progress:n})):0!==n&&1!==n||this.animatingNodes.has(t)&&(1===n&&l({node:t,entry:e,scrollingUp:o,progress:n}),this.animatingNodes.delete(t)),r.setProperty("--trigger",`${n}`),r.setProperty("--trigger-px",`${s}`)})}initObserver(e){let{root:t}=e,r=l(e,h);this.scroller=t,this.observer=new IntersectionObserver((e,t)=>{this.updateEntries(e),this.update()},c({root:t,rootMargin:`${v.ROOTMARGINEXT}px 0px`},r))}init(e){return this.initObserver(e),this.observeAll(),this.onScroll(),this}add(e){let{node:t}=e,r=l(e,g);this.nodes.set(t,r),t.style.setProperty("--trigger","0"),t.style.setProperty("--trigger-px","0"),this.observe(t)}observe(e){this.observer&&this.observer.observe(e)}unobserve(e){this.observer&&this.observer.unobserve(e)}destroy(){this.observer&&this.observer.disconnect()}observeAll(){this.nodes.forEach((e,t)=>{this.observe(t)})}onScroll(e){if(e&&this.mounted){if(!(e.target instanceof HTMLElement||e.target instanceof Window))return;const t=e.target instanceof HTMLElement?e.target.scrollTop:e.target instanceof Document?e.target.documentElement.scrollTop:e.target instanceof Window?e.target.scrollX:0;this.mounted=!0,this.setScrollDirection(t)}this.visibleNodes&&0!==this.visibleNodes.size&&this.visibleNodes.forEach((e,t)=>{this.unobserve(t),this.observe(t)})}}v.ROOTMARGINEXT=0;const b="undefined"!=typeof window?t:r;function p(e,t){const r=n(null),o=n(null);o.current=t;const i=n(null),c=s(()=>{const t=o.current,n=i.current||(t?t instanceof Element?t:t.current:null);r.current&&r.current.element===n&&r.current.subscriber===e||(r.current&&r.current.cleanup&&r.current.cleanup(),r.current={element:n,subscriber:e,cleanup:n?e(n):void 0})},[e]);return b(()=>{c()}),b(()=>()=>{r.current&&r.current.cleanup&&(r.current.cleanup(),r.current=null)},[]),s(e=>{i.current=e,c()},[c])}const f=["name","ref","style"],m=({root:u,onScroll:h})=>{const g=s(()=>u?"string"==typeof u?document.getElementById(u):u instanceof HTMLElement?u:u.current:document.documentElement,[u]),[b]=o(()=>new v),m=(t=>{const r=e.useRef(t);return e.useEffect(()=>{r.current=t}),r})(h);t(()=>{b.init({root:g()})},[g,b]);const y=p(e=>{const t=e=>{b.onScroll(e),null==m.current||m.current(e)};return e.addEventListener("scroll",t,{passive:!0}),()=>{b.destroy(),e.removeEventListener("scroll",t,{passive:!0})}},g()),{ref:x}=function(e={}){const t=e.onResize,c=n(void 0);c.current=t;const l=e.round||Math.round,u=n(),[a,h]=o({width:void 0,height:void 0}),g=n(!1);r(()=>(g.current=!1,()=>{g.current=!0}),[]);const v=n({width:void 0,height:void 0}),b=p(s(t=>(u.current&&u.current.box===e.box&&u.current.round===l||(u.current={box:e.box,round:l,instance:new ResizeObserver(t=>{const r=t[0],n="border-box"===e.box?"borderBoxSize":"device-pixel-content-box"===e.box?"devicePixelContentBoxSize":"contentBoxSize",s=d(r,n,"inlineSize"),o=d(r,n,"blockSize"),i=s?l(s):void 0,u=o?l(o):void 0;if(v.current.width!==i||v.current.height!==u){const e={width:i,height:u};v.current.width=i,v.current.height=u,c.current?c.current(e):g.current||h(e)}})}),u.current.instance.observe(t,{box:e.box}),()=>{u.current&&u.current.instance.unobserve(t)}),[e.box,l]),e.ref);return i(()=>({ref:b,width:a.width,height:a.height}),[b,a.width,a.height])}({ref:g(),onResize:s(()=>{b.observeAll()},[b])});return{register:function(e){let{name:t,ref:r,style:n}=e,s=l(e,f);return{id:`${t}`,ref:a(e=>{e&&(e=>{const{node:t,start:r,end:n}=e;t.dataset.start=r,t.dataset.end=n,b.add(e)})(c({node:e,name:t},s))},r),style:c({},n)}},scrollerRef:i(()=>a(y,x),[y,x])}};export{m as default,m as useScrollTrigger};
//# sourceMappingURL=index.modern.js.map
