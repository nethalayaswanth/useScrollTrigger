!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e||self).usescrolltrigger={},e.react)}(this,function(e,t){function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,t}var r=/*#__PURE__*/n(t);function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i.apply(this,arguments)}function o(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}var s=function(e,t,n){return Math.max(t,Math.min(e,n))};function u(){var e=arguments;return function(t){[].slice.call(e).forEach(function(e){"function"==typeof e?e(t):null!=e&&(e.current=t)})}}function c(e,t,n){return e[t]?e[t][0]?e[t][0][n]:e[t][n]:"contentBoxSize"===t?e.contentRect["inlineSize"===n?"width":"height"]:void 0}var a=["root"],l=["node"],f=/*#__PURE__*/function(){function e(){this.nodes=new Map,this.visibleNodes=new Map,this.animatingNodes=new Set,this.observer=null,this.scroller=null,this.direction=null,this.mounted=!1,this.prevYPosition=0,this.scroll=!0}var t=e.prototype;return t.setScrollDirection=function(e){this.direction=e<this.prevYPosition?"down":"up",this.prevYPosition=e},t.handleIntersecting=function(e){var t=e.target;if(e.isIntersecting)this.visibleNodes.set(t,e),t.classList.add("trigger");else{var n;if(!this.direction)return;var r="up"===this.direction;t.classList.remove("trigger"),t.style.setProperty("--trigger",r?" 1":" 0"),t.style.setProperty("--trigger-px",r&&null!=(n=t.dataset.end)?n:"0")}},t.updateEntries=function(e){var t=this;this.visibleNodes=new Map,e.forEach(function(e){t.handleIntersecting(e)})},t.caluclatePosition=function(e){if(!e)return[0,0];var t=e.boundingClientRect,n=t.top;if(!e.rootBounds)return[0,0];var r=e.rootBounds.height-40,i=0,o=r+t.height,u=e.target;u.dataset.start&&(i=parseInt(u.dataset.start,10)),u.dataset.end&&(o=parseInt(u.dataset.end,10));var c=o-i,a=r-n-i;return[s(a/c,0,1),s(a,0,c)]},t.update=function(){var e=this;this.visibleNodes.forEach(function(t,n){var r=n.style,i=e.caluclatePosition(t),o=i[0],s=i[1],u="up"===e.direction,c=e.nodes.get(n),a=c.onStart,l=c.onProgress,f=c.onEnd;o>0&&o<1?(e.animatingNodes.has(n)||(e.animatingNodes.add(n),u&&a({node:n,entry:t,scrollingUp:u,progress:o})),l({node:n,entry:t,scrollingUp:u,progress:o})):0!==o&&1!==o||e.animatingNodes.has(n)&&(1===o&&f({node:n,entry:t,scrollingUp:u,progress:o}),e.animatingNodes.delete(n)),r.setProperty("--trigger",""+o),r.setProperty("--trigger-px",""+s)})},t.initObserver=function(t){var n=this,r=t.root,s=o(t,a);this.scroller=r,this.observer=new IntersectionObserver(function(e,t){n.updateEntries(e),n.update()},i({root:r,rootMargin:e.ROOTMARGINEXT+"px 0px"},s))},t.init=function(e){return this.initObserver(e),this.observeAll(),this.onScroll(),this},t.add=function(e){var t=e.node,n=o(e,l);this.nodes.set(t,n),t.style.setProperty("--trigger","0"),t.style.setProperty("--trigger-px","0"),this.observe(t)},t.observe=function(e){this.observer&&this.observer.observe(e)},t.unobserve=function(e){this.observer&&this.observer.unobserve(e)},t.destroy=function(){this.observer&&this.observer.disconnect()},t.observeAll=function(){var e=this;this.nodes.forEach(function(t,n){e.observe(n)})},t.onScroll=function(e){var t=this;if(e&&this.mounted){if(!(e.target instanceof HTMLElement||e.target instanceof Window))return;var n=e.target instanceof HTMLElement?e.target.scrollTop:e.target instanceof Document?e.target.documentElement.scrollTop:e.target instanceof Window?e.target.scrollX:0;this.mounted=!0,this.setScrollDirection(n)}this.visibleNodes&&0!==this.visibleNodes.size&&this.visibleNodes.forEach(function(e,n){t.unobserve(n),t.observe(n)})},e}();f.ROOTMARGINEXT=0;var d="undefined"!=typeof window?t.useLayoutEffect:t.useEffect;function h(e,n){var r=t.useRef(null),i=t.useRef(null);i.current=n;var o=t.useRef(null),s=t.useCallback(function(){var t=i.current,n=o.current||(t?t instanceof Element?t:t.current:null);r.current&&r.current.element===n&&r.current.subscriber===e||(r.current&&r.current.cleanup&&r.current.cleanup(),r.current={element:n,subscriber:e,cleanup:n?e(n):void 0})},[e]);return d(function(){s()}),d(function(){return function(){r.current&&r.current.cleanup&&(r.current.cleanup(),r.current=null)}},[]),t.useCallback(function(e){o.current=e,s()},[s])}var v=["name","ref","style"],g=function(e){var n,s,a=e.root,l=e.onScroll,d=t.useCallback(function(){return a?"string"==typeof a?document.getElementById(a):a instanceof HTMLElement?a:a.current:document.documentElement},[a]),g=t.useState(function(){return new f})[0],b=(s=r.useRef(n=l),r.useEffect(function(){s.current=n}),s);t.useLayoutEffect(function(){g.init({root:d()})},[d,g]);var p=h(function(e){var t=function(e){g.onScroll(e),null==b.current||b.current(e)};return e.addEventListener("scroll",t,{passive:!0}),function(){g.destroy(),e.removeEventListener("scroll",t,{passive:!0})}},d()),y=function(e){void 0===e&&(e={});var n=e.onResize,r=t.useRef(void 0);r.current=n;var i=e.round||Math.round,o=t.useRef(),s=t.useState({width:void 0,height:void 0}),u=s[0],a=s[1],l=t.useRef(!1);t.useEffect(function(){return l.current=!1,function(){l.current=!0}},[]);var f=t.useRef({width:void 0,height:void 0}),d=h(t.useCallback(function(t){return o.current&&o.current.box===e.box&&o.current.round===i||(o.current={box:e.box,round:i,instance:new ResizeObserver(function(t){var n=t[0],o="border-box"===e.box?"borderBoxSize":"device-pixel-content-box"===e.box?"devicePixelContentBoxSize":"contentBoxSize",s=c(n,o,"inlineSize"),u=c(n,o,"blockSize"),d=s?i(s):void 0,h=u?i(u):void 0;if(f.current.width!==d||f.current.height!==h){var v={width:d,height:h};f.current.width=d,f.current.height=h,r.current?r.current(v):l.current||a(v)}})}),o.current.instance.observe(t,{box:e.box}),function(){o.current&&o.current.instance.unobserve(t)}},[e.box,i]),e.ref);return t.useMemo(function(){return{ref:d,width:u.width,height:u.height}},[d,u.width,u.height])}({ref:d(),onResize:t.useCallback(function(){g.observeAll()},[g])}).ref;return{register:function(e){var t=e.name,n=e.ref,r=e.style,s=o(e,v);return{id:""+t,ref:u(function(e){e&&function(e){var t=e.node,n=e.end;t.dataset.start=e.start,t.dataset.end=n,g.add(e)}(i({node:e,name:t},s))},n),style:i({},r)}},scrollerRef:t.useMemo(function(){return u(p,y)},[p,y])}};e.default=g,e.useScrollTrigger=g});
//# sourceMappingURL=index.umd.js.map
